<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindCare Mini Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Importing stylish fonts from Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Pacifico&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
        }
        
        /* Applying the stylish font to the main heading */
        .font-pacifico {
            font-family: 'Pacifico', cursive;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.2);
            width: 24px; height: 24px; border-radius: 50%;
            border-left-color: #ffffff; animation: spin 1s ease infinite;
        }
        @keyframes spin { 0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);} }
        
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from {opacity:0;transform:translateY(10px);} to {opacity:1;transform:translateY(0);} }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-300 via-purple-300 to-indigo-400 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white/80 backdrop-blur-xl p-8 rounded-2xl shadow-2xl w-full max-w-lg border border-white/80">
        <div class="text-center mb-8">
            <!-- Updated heading with the new font class -->
            <h1 class="text-4xl md:text-4xl lg:text-[2.8rem] font-pacifico text-gray-800">MindCare Mini</h1>
            <!-- Update the subheading -->
            <p class="text-red-800 mt-4" style="font-family: 'Playfair Display', serif; font-size: 0.9rem; letter-spacing: 0.5px;">
                Your friendly AI for mental well-being.
            </p>
        </div>
        <div class="mb-4">
            <label for="userInput" class="block text-sm font-medium text-gray-700 mb-2">How are you feeling today?</label>
            <textarea id="userInput" rows="4" class="w-full px-4 py-3 bg-white/80 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition" placeholder="e.g., I'm feeling a bit overwhelmed with work..."></textarea>
        </div>
        <button
            id="getSuggestionBtn"
            class="w-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition duration-200 ease-in-out flex items-center justify-center space-x-2
                hover:from-pink-500 hover:via-indigo-500 hover:to-purple-500
                hover:scale-105 hover:shadow-2xl focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
        >
            <span id="button-text">Get a Suggestion</span>
            <div id="spinner" class="hidden spinner"></div>
        </button>
        <div id="result-container" class="hidden mt-6">
            <div id="result" class="p-5 bg-indigo-50 border border-indigo-200 text-indigo-900 rounded-lg shadow-inner"></div>
        </div>
        <p class="text-xs text-gray-500 text-center mt-8">
            This is an AI-powered agent and not a substitute for professional medical advice.
        </p>
    </div>



    <script>
        // API key is no longer stored here!

        const getSuggestionBtn = document.getElementById('getSuggestionBtn');
        const buttonText = document.getElementById('button-text');
        const userInput = document.getElementById('userInput');
        const resultContainer = document.getElementById('result-container');
        const resultDiv = document.getElementById('result');
        const spinner = document.getElementById('spinner');

        async function getSuggestionFromBackend(userText) {
            // This now points to our secure Vercel API endpoint
            const url = `/api/get-suggestion`;
            
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userText: userText })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'An unknown server error occurred.');
            }

            return data.suggestion;
        }

        getSuggestionBtn.addEventListener('click', async () => {
            const userText = userInput.value.trim();

            if (!userText) {
                resultDiv.textContent = "Please share how you're feeling to get a suggestion.";
                resultContainer.classList.remove('hidden');
                resultDiv.parentElement.classList.add('fade-in');
                resultDiv.className = "p-5 bg-yellow-50 border border-yellow-200 text-yellow-900 rounded-lg shadow-inner";
                return;
            }

            spinner.classList.remove('hidden');
            buttonText.textContent = 'Thinking...';
            resultContainer.classList.add('hidden');
            getSuggestionBtn.disabled = true;

            try {
                const suggestion = await getSuggestionFromBackend(userText);
                resultDiv.textContent = suggestion;
                resultDiv.className = "p-5 bg-red-50 border border-red-200 text-red-900 rounded-lg shadow-inner";
            } catch (error) {
                resultDiv.textContent = `Sorry, something went wrong. Error: ${error.message}`;
                resultDiv.className = "p-5 bg-red-50 border border-red-200 text-red-900 rounded-lg shadow-inner";
            } finally {
                spinner.classList.add('hidden');
                buttonText.textContent = 'Get a Suggestion';
                resultContainer.classList.remove('hidden');
                resultContainer.classList.add('fade-in');
                getSuggestionBtn.disabled = false;
            }
        });
    </script>
</body>
</html>